<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="../public/css/student.css">
    <title>Student Management</title>
</head>
<body>
    <div class="container">
        <div class="header--wrapper">
            <div class="header--title">
                <h2>Student Management</h2>
            </div>
            <div class="user--info">
                <div class="search--box">
                    <i class="fa solid fa-search"></i>
                    <input type="text" placeholder="Search">
                </div>
                <a href="#" class="dropdown-toggle" >
                    <div class="account" onclick="showHideDropMenu()">
                        <img src="../public/images/account.jpg" alt="">
                        <span class="user-name">Mangtrungzos</span>
                    </div>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item">
                            <img src="../public/images/user.png" alt="" class="imgs">
                            Profile
                        </a>
                        <a href="#" class="dropdown-item">
                            <img src="../public/images/settings.png" alt="" class="imgs">
                            Setting
                        </a>
                        <a href="../pages/login.html" class="dropdown-item">
                            <img src="../public/images/log-out.png" alt="" class="imgs">
                            Logout
                        </a>
                    </div>
                </a>
            </div>
        </div>
        <!------- Content ------>
        <div class="contain">
            <div class="sidebar" >
                <div class="logo">
                    <img src="../public/images/U.png" alt="" width="110px" height="110px">
                </div>
                <ul class="menu">
                    <li>
                        <a href="../pages/home.html">
                            <img src="../public/images/dashboard.png" alt="" width="20px" height="20px">
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="menu-student pding-4 active">
                        <a href="#" class="student-list" onclick="showHideStudent()">
                            <img src="../public/images/user.png" alt="" width="20px" height="20px">
                            <span>Student</span>
                            <!-- <i class="fa-solid fa-caret-down icon-down"></i> -->
                            <img class="icon-down" src="../public/images/down-arrow.png" alt="" width="20px" height="20px">
                        </a>
                        <ul class="student--list">
                            <li><a href="./studentList.html" class="mrg-top">Student list</a></li>
                            <li><a href="../pages/studentadd.html">Studen add</a></li>
                            <li><a href="#">Student scores</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <a href="./notification.html">
                            <img src="../public/images/notification.png" alt="" width="20px" height="20px">
                            <span>Notify</span>
                        </a>
                    </li>
                    <li class="logout" id="logout">
                        <a href="./login.html">
                            <img src="../public/images/log-out.png" alt="" width="20px" height="20px">
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="main--content">
                <div class="user--container">
                    <ol class="title--contain">
                        <li><a href="">Students</a></li>
                        <li class="active-clr">/ Students List</li>
                    </ol>
                    <h2 class="main--title">Students List</h2>
                    <div class="user--wrapperl">
                        <div class="addstudent--new">
                            
                        </div>
                        <div class="studentlist">
                            <div class="scoreOptions">
                                <button id="addscore" onclick="addScore()">Add Score</button>
                                <button id="exportscore" onclick="exportScore()">Export Score</button>
                            </div>
                            <table class="table-head table-heads">
                                <tr>
                                    <th class="border-left masv">MSSV</th>
                                    <th class="border-left">Mã môn học</th>
                                    <th class="border-left">Tên môn học</th>
                                    <th class="border-left">Điểm</th>
                                </tr>
                            </table>
                            <div id="loading"></div>
                            <table id="tableBody" class="table-body"></table>
                        </div>
                    </div>
                   
                </div>
            </div>
        </div>
    </div>
    <script src="/student-management-app/server/controllers/handleClick.js"></script>
    <script src="../../server/controllers/editScores.js"></script>
    <script src="../../server/controllers/deleteScore.js"></script>
    <script>
        const tableBody = document.querySelector('.table-body');
        async function fetchData() {
            try {
                const responseAPI = await fetch('http://localhost:3000/score');
                const scores = await responseAPI.json();
                
                tableBody.innerHTML = 
                scores.map(
                    (score) => `
                        <tr style="display: grid; grid-template-columns: 200px 200px 350px 150px 150px;">
                        <td style="text-align: center">${score.MASV}</td>
                        <td style="padding-left: 50px">${score.MAMH}</td>
                        <td style="width: 250px">${score.TENMH}</td> 
                        <td style="padding-left: 31px">${score.DIEM}</td>
                        <td style="display: flex; flex-direction: row; justify-content: flex-end; width: 150px">
                            <button style="background-color: #ccc; width: 65px; font-size: 12px; justify-content: center" onclick="editStudent(${score.MASV})">Edit</button>
                            
                            <button style="background-color: #ccc; width: 65px; font-size: 12px; justify-content: center; margin-left: 9px" onclick="deleteStudent(${score.MASV})">Delete</button>
                        </td>
                        </tr>
                        `
                        ).join('');
                    } 
                    catch (error) {
                tableBody.innerHTML = `<span style="color: red; display: block; padding: 12px;">Failed to load data. Please try again later.</span>`;
                console.error("There was an error fetching the data:", error);
            } 
            finally {
                loading.style.display = 'none';
            }


        }
        fetchData();
        </script>
        <script src="../../server/controllers/exportExcel.js"></script>
</body>
</html>
